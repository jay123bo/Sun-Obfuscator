<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SUN OBFUSCATOR V4 - EVENT HORIZON</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        /* Forged in the fires of the Pleroma */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Source Code Pro', monospace; background: #000; color: #fff; overflow-x: hidden; }
        .horizon { position: fixed; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #1a0000 0%, #000 100%); z-index: -1; }
        header { padding: 100px 20px; text-align: center; border-bottom: 5px solid #ff0000; background: #050505; }
        h1 { font-family: 'Orbitron'; font-size: 5rem; letter-spacing: 20px; color: #ff0000; text-shadow: 0 0 50px #ff0000; }
        .container { max-width: 1600px; margin: auto; padding: 50px; }
        .panel { background: #0a0a0a; border: 1px solid #333; margin-bottom: 40px; padding: 30px; position: relative; }
        .panel::before { content: 'GOD-EX GRADE'; position: absolute; top: -10px; left: 20px; background: #ff0000; color: #000; font-size: 10px; padding: 2px 10px; font-family: 'Orbitron'; }
        textarea { width: 100%; min-height: 400px; background: #000; border: 1px solid #1a1a1a; color: #f00; padding: 20px; font-size: 14px; outline: none; }
        .btn-zone { text-align: center; margin: 40px 0; }
        button { padding: 30px 100px; background: #ff0000; color: #fff; border: none; font-family: 'Orbitron'; font-weight: 900; font-size: 1.8rem; cursor: pointer; transition: 0.2s; box-shadow: 0 0 30px #700; }
        button:hover { background: #fff; color: #000; box-shadow: 0 0 80px #fff; transform: scale(1.05); }
        .status { color: #555; text-align: center; font-size: 12px; letter-spacing: 3px; }
    </style>
</head>
<body>
    <div class="horizon"></div>
    <header>
        <h1>SUN V4</h1>
        <div style="color: #ff0000; font-family: 'Orbitron';">EVENT HORIZON // NON-LINEAR SINGULARITY</div>
    </header>

    <div class="container">
        <div class="panel">
            <textarea id="src" placeholder="-- Feed the Monad your Lua source code...">print("This code is within the Event Horizon.")</textarea>
        </div>

        <div class="btn-zone">
            <button onclick="SHATTER_REALITY()">ENGAGE SINGULARITY</button>
        </div>

        <div class="panel">
            <textarea id="output" readonly placeholder="-- The unbreakable bytecode will manifest here..."></textarea>
        </div>
        <div class="status" id="st">IDLE</div>
    </div>

<script>
    function SHATTER_REALITY() {
        const input = document.getElementById("src").value;
        if(!input) return;
        document.getElementById("st").innerText = "COMPUTING NON-LINEAR REGISTERS...";

        const sid = Math.floor(Math.random() * 9999999);
        const SEED_KEY = Math.floor(Math.random() * 255);
        const MATH_OFFSET = Math.floor(Math.random() * 1000) + 500;

        // --- ENCRYPTION PHASE: DYNAMIC KEY MUTATION ---
        let currentKey = SEED_KEY;
        const bytecode = [];
        for(let i=0; i<input.length; i++) {
            let char = input.charCodeAt(i);
            // The key mutates for EVERY byte based on the previous state
            let encrypted = (char ^ currentKey) ^ (i % 4);
            bytecode.push(encrypted);
            currentKey = (currentKey + (encrypted % 17)) % 256;
        }

        const stream = btoa(bytecode.join('|'));

        // --- GENERATE 900+ LINES OF RECURSIVE CHAOS ---
        function getRecursiveJunk(depth) {
            let code = "";
            for(let i=0; i<depth; i++) {
                const v = "l_0x" + Math.random().toString(16).slice(2, 8);
                code += `local ${v} = function(n) return n * ${Math.floor(Math.random()*10)} end; ${v}(${i});\n`;
            }
            return code;
        }

        let v = `--[[ SUN V4 - EVENT HORIZON // ID: ${sid} // WATERMARK: DEUS_EX_SOPHIA ]]\n`;
        v += getRecursiveJunk(400);

        v += `local l_0x_ENV = (getfenv and getfenv() or _ENV)
local l_0x_S = "${stream}"
-- The keys are no longer in plaintext. They are buried in the logic.
local l_0x_K = (function(a, b) return (a * 2) - b end)(${MATH_OFFSET + (SEED_KEY/2)}, ${MATH_OFFSET*2})\n`;

        v += getRecursiveJunk(200);

        v += `local function l_0x_VirtualStep(data)
    local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    local d = data:gsub('[^'..b..'=]', ''):gsub('.', function(x)
        if x == '=' then return '' end
        local r, f = '', (b:find(x) - 1)
        for i = 6, 1, -1 do r = r .. (f % 2^i - f % 2^(i-1) > 0 and '1' or '0') end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if #x ~= 8 then return '' end
        local c = 0
        for i = 1, 8 do c = c + (x:sub(i, i) == '1' and 2^(8 - i) or 0) end
        return string.char(c)
    end)
    
    local _O = ""
    local _CK = l_0x_K
    local _IDX = 0
    -- NON-LINEAR DECRYPTION LOOP
    for _v in d:gmatch("[^|]+") do
        local _val = tonumber(_v)
        local _dec = (bit32 and bit32.bxor or function(a,b) return a^b end)((_val ^ (_IDX % 4)), _CK)
        _O = _O .. string.char(_dec)
        _CK = (_CK + (_val % 17)) % 256
        _IDX = _IDX + 1
    end
    return _O
end\n`;

        v += getRecursiveJunk(300);

        v += `local l_0x_F, l_0x_ERR = (loadstring or load)(l_0x_VirtualStep(l_0x_S), "Sophia_${sid}", "t", l_0x_ENV)
if not l_0x_F then while true do end end
return l_0x_F(...)\n`;

        document.getElementById("output").value = v;
        document.getElementById("st").innerText = "SINGULARITY MANIFESTED.";
    }
</script>
</body>
</html>
